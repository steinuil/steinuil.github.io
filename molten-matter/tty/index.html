<html><head><title>The TTY Protocol</title><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" /><link rel="stylesheet" href="/assets/style.css" type="text/css" /><link rel="alternate" href="/rss.xml" type="application/rss+xml" title="RSS feed" /><link rel="alternate" href="/feed.xml" type="application/atom+xml" title="Atom feed" /></head><body id="blog-post-page"><div class="body-container"><header><nav><ul><li><a href="/molten-matter/">Molten Matter</a></li><li><a href="/">About</a></li><li><a href="/legal/">Legal</a></li></ul></nav></header><main><header><div class="post-title">The TTY Protocol</div> <time datetime="2017-02-10">2017/02/10</time></header><div class="text"><p>A few months ago, <a href="https://destroyallsoftware.com">Gary Bernhardt</a> streamed himself writing a text editor. I&rsquo;m not sure he ever finished it, and for some reason he took down the VoDs on Twitch, but the little I&rsquo;ve seen was still very interesting.</p><p>Writing my own text editor (and using it) has always been one of my dreams and, being a vim user, I&rsquo;d much rather have it run on my terminal. Bernhardt shares my opinion, so he started by writing (or rather, copying from one of his previous projects) the terminal interaction code. I&rsquo;ve always thought terminal interaction would be pretty complicated, but it turned out to be a very small amount of code.</p><p>This got me wondering about the protocol.</p></div><header class="heading" id="a-brief-incomplete-and-mostly-wrong-history-of-the-tty-protocol">A brief, incomplete, and mostly wrong history of the TTY protocol</header><div class="text"><p>The TTY protocol predates computers by quite a bit, and hasn&rsquo;t changed much since the late 19th century. The protocol was created for <strong>teletypewriters</strong>, or teletypes, to communicate with each other: it included not only printable characters such as numbers, alphabets, and punctuation, but also directives for the teletype that were not supposed to be printed called <strong>control characters</strong>, such as Line Feed (<code>\n</code>).</p><p>The character encodings that we still have to deal with nowadays also largely come from back then: Unicode later tried to patch them all together, but it was already too late.</p><p>Then computers came along. Printing the result of a computation to a sheet of paper was way easier than interpreting a bunch of lights on a front panel, so they stuck teletypes to them, and thus computers learnt the TTY protocol too.</p><p>When screens became widespread, the protocol acquired more commands known as <strong>escape sequences</strong>, so called because they were prefixed by ESC (<code>0x1B</code>). These allowed computers to move the cursor arbitrarily on the screen, clearing part of it or applying some effects such as inverting the background and the foreground color.</p><p>Some terminals, such as the Tektronix 4010 series, also allowed drawing lines on the screen thanks to their vector displays. These unfortunately died an untimely death (even though a tek emulation mode still lives on inside xterm), and only the text-based VTs stuck.</p></div><header class="heading" id="summing-up">Summing up</header><div class="text"><p>For most intents and purposes, <code>/dev/tty</code> still behaves a lot like a physical typewriter: you can scroll the &ldquo;sheet of paper&rdquo;, you can move the cursor around, you can imbue its head with colored ink or special effects. You can easily find your way around with <a href="http://www.xfree86.org/4.5.0/ctlseqs.html">a control sequences chart</a>, and it&rsquo;s not hard to emulate ncurses or readline just by printing a few characters in <a href="https://en.wikipedia.org/wiki/Cooked_mode">raw mode</a>.</p><p>The TTY is unfortunately very stateful, but <a href="https://github.com/nsf/termbox">termbox</a> provides a very nice abstraction: it essentially turns all interactions stateless by printing a few more escape sequences every time you write something.</p><p>I&rsquo;m not sure if I&rsquo;ll ever write my own text editor, but it&rsquo;s certainly fun to play with terminal graphics and line editing using nothing but <code>write</code>.</p></div><header class="heading" id="further-reading">Further reading</header><ul><li><a href="https://www.destroyallsoftware.com/talks/a-whole-new-world">Gary Bernhardt - A Whole New World</a></li><li><a href="https://garbagecollected.org/2017/01/31/four-column-ascii/">Four Column ASCII</a></li><li><a href="http://www.linusakesson.net/programming/tty/">The TTY demystified</a></li><li><a href="https://github.com/pqwy/notty">Declarative terminal graphics for OCaml</a></li><li><a href="http://use.perl.org/use.perl.org/_scrottie/journal/39195.html">Playing with Tektronix emulation for vector graphics!</a></li><li><a href="https://github.com/withoutboats/notty">notty: A new kind of terminal</a></li><li><a href="http://systemswe.love/videos/utf-8">Daniel Morsing - UTF&ndash;8</a></li><li><a href="https://utcc.utoronto.ca/~cks/space/blog/unix/HowUnixBackspaces">How Unix erases things when you type a backspace while entering text</a></li><li><a href="http://denisbider.blogspot.com/2015/09/when-monospace-fonts-arent-unicode.html">When monospace fonts aren&rsquo;t: The Unicode character width nightmare</a></li></ul></main><footer>made with <a href="https://racket-lang.org/">racket</a> // <a href="/rss.xml">rss</a> // <a href="/feed.xml">atom</a></footer></div></body></html>