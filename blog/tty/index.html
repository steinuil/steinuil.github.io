<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><title>The TTY Protocol</title><meta content="steen's online burrow" name=description><meta content=Zola name=generator><meta content=strict-origin name=referrer><link href=https://sgt.hootr.club/assets/style.css rel=stylesheet><link title="RSS feed" href=/rss.xml rel=alternate type=application/rss+xml><link title="Atom feed" href=/atom.xml rel=alternate type=application/atom+xml><link href=/assets/icon/favicon-152.png rel=apple-touch-icon-precomposed><body class=main-parent><div class=main-parent><header class=main><h1 class=header-title><a href=https://sgt.hootr.club>STEENSBURROW</a></h1><nav><ul class=unstyled><li><a class=unstyled href=https://sgt.hootr.club/me/>me</a><li><a class=unstyled href=https://sgt.hootr.club/blog/>posts</a><li><a class=unstyled href=https://sgt.hootr.club/meta/>meta</a></ul></nav></header><main class=main><article><header><h1 class=title>The TTY Protocol</h1><p class=subtitle>Published by <a href=/><i>steen</i></a> on <time datetime=2017-02-10>2017-02-10</time> tagged <a class=tag href=https://sgt.hootr.club/tags/terminal/>#terminal</a></header><div class=content><p>A few months ago, <a rel="nofollow noreferrer" class=external-link href=https://destroyallsoftware.com>Gary Bernhardt</a> streamed himself writing a text editor. I'm not sure he ever finished it, and for some reason he took down the VoDs on Twitch, but the little I've seen was still very interesting.<p>Writing my own text editor (and using it) has always been one of my dreams and, being a vim user, I'd much rather have it run on my terminal. Bernhardt shares my opinion, so he started by writing (or rather, copying from one of his previous projects) the terminal interaction code. I've always thought terminal interaction would be pretty complicated, but it turned out to be a very small amount of code.<p>This got me wondering about the protocol.<h2 id=a-brief-incomplete-and-mostly-wrong-history-of-the-tty-protocol>A brief, incomplete, and mostly wrong history of the TTY protocol</h2><p>The TTY protocol predates computers by quite a bit, and hasn't changed much since the late 19th century. The protocol was created for <strong>teletypewriters</strong>, or teletypes, to communicate with each other: it included not only printable characters such as numbers, alphabets, and punctuation, but also directives for the teletype that were not supposed to be printed called <strong>control characters</strong>, such as Line Feed (<code>\n</code>).<p>The character encodings that we still have to deal with nowadays also largely come from back then: Unicode later tried to patch them all together, but it was already too late.<p>Then computers came along. Printing the result of a computation to a sheet of paper was way easier than interpreting a bunch of lights on a front panel, so they stuck teletypes to them, and thus computers learnt the TTY protocol too.<p>When screens became widespread, the protocol acquired more commands known as <strong>escape sequences</strong>, so called because they were prefixed by ESC (<code>0x1B</code>). These allowed computers to move the cursor arbitrarily on the screen, clearing part of it or applying some effects such as inverting the background and the foreground color.<p>Some terminals, such as the Tektronix 4010 series, also allowed drawing lines on the screen thanks to their vector displays. These unfortunately died an untimely death (even though a tek emulation mode still lives on inside xterm), and only the text-based VTs stuck.<h2 id=summing-up>Summing up</h2><p>For most intents and purposes, <code>/dev/tty</code> still behaves a lot like a physical typewriter: you can scroll the "sheet of paper", you can move the cursor around, you can imbue its head with colored ink or special effects. You can easily find your way around with <a rel="nofollow noreferrer" class=external-link href=http://www.xfree86.org/4.5.0/ctlseqs.html>a control sequences chart</a>, and it's not hard to emulate ncurses or readline just by printing a few characters in <a rel="nofollow noreferrer" class=external-link href=https://en.wikipedia.org/wiki/Cooked_mode>raw mode</a>.<p>The TTY is unfortunately very stateful, but <a rel="nofollow noreferrer" class=external-link href=https://github.com/nsf/termbox>termbox</a> provides a very nice abstraction: it essentially turns all interactions stateless by printing a few more escape sequences every time you write something.<p>I'm not sure if I'll ever write my own text editor, but it's certainly fun to play with terminal graphics and line editing using nothing but <code>write</code>.<h2 id=further-reading>Further reading</h2><ul><li><a rel="nofollow noreferrer" class=external-link href=https://www.destroyallsoftware.com/talks/a-whole-new-world>Gary Bernhardt - A Whole New World</a><li><a rel="nofollow noreferrer" class=external-link href=https://garbagecollected.org/2017/01/31/four-column-ascii/>Four Column ASCII</a><li><a rel="nofollow noreferrer" class=external-link href=http://www.linusakesson.net/programming/tty/>The TTY demystified</a><li><a rel="nofollow noreferrer" class=external-link href=https://github.com/pqwy/notty>Declarative terminal graphics for OCaml</a><li><a rel="nofollow noreferrer" class=external-link href=http://use.perl.org/use.perl.org/_scrottie/journal/39195.html>Playing with Tektronix emulation for vector graphics!</a><li><a rel="nofollow noreferrer" class=external-link href=https://github.com/withoutboats/notty>notty: A new kind of terminal</a><li><a rel="nofollow noreferrer" class=external-link href=http://systemswe.love/videos/utf-8>Daniel Morsing - UTF-8</a><li><a rel="nofollow noreferrer" class=external-link href=https://utcc.utoronto.ca/~cks/space/blog/unix/HowUnixBackspaces>How Unix erases things when you type a backspace while entering text</a><li><a rel="nofollow noreferrer" class=external-link href=http://denisbider.blogspot.com/2015/09/when-monospace-fonts-arent-unicode.html>When monospace fonts aren't: The Unicode character width nightmare</a></ul></div></article></main><footer class=main><a class=logo href=/> <svg viewbox="0 0 79 49" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg><title>Steen's online burrow</title><g fill=currentColor><g><path d="M 17,7 V 9 H 15 V 8 h -1 v 3 h 1 v 1 h 2 v 1 h 4 V 9 H 20 V 8 H 19 V 5 h 1 V 4 h 1 V 3 h 4 v 1 h -3 v 3 h 1 v 1 h 1 v 4 h -1 v 1 h -1 c 0,0 0,1 0,1 H 16 V 13 H 13 V 12 10 H 12 V 8 h 1 V 7 Z"/><path d="m 30,5 v 1 h 2 V 5 h 3 v 1 h -2 v 1 h -2 v 4 h -1 v 1 h -1 v 1 h -1 c 0,0 0,2 0,2 h -1 c 0,0 0,1 0,1 h -1 v -3 h 1 v -2 h 1 V 7 H 26 V 6 H 24 V 5 Z"/><path d="m 39,5 v 2 h -1 c 0,0 0,1 0,1 h -1 c 0,0 0,1 0,1 h -2 v 1 h 4 c 0,0 0,2 0,2 h -2 v -1 h -3 v 1 h -1 v 2 h 2 v -1 h 3 v 1 h 1 v 1 h 1 c 0,0 0,1 0,1 h -2 v -1 h -4 c 0,0 0,1 0,1 h -4 v -1 h 1 v -2 h 1 v -2 h 1 V 8 h 3 V 7 h 1 V 6 h 1 V 5 Z"/><path d="m 42,5 v 1 h 1 v 1 h 1 v 1 h 1 v 1 h 2 v 1 H 44 V 9 h -1 v 2 h 3 v 1 h -2 v 1 h -1 v 1 h 2 v -1 h 2 v 2 h -4 c 0,0 0,1 0,1 h -2 v -2 h 1 V 9 H 41 V 7 H 40 V 5 Z"/><path d="m 48,6 v 2 h 1 v 4 h 1 c 0,0 0,2 0,2 h -1 v 3 c 0,0 1,0 1,0 v -1 h 1 v -2 h 1 v -2 h 1 v 1 h 1 v 1 h 1 v 1 h 2 V 14 H 56 V 9 h 1 V 7 h 1 V 5 h 1 V 4 h 1 V 2 h -1 v 1 h -2 v 1 h -1 v 4 h -1 v 4 H 54 V 11 H 53 V 10 H 51 V 8 H 50 V 7 H 49 V 6 Z"/><path d="m 61,0 v 1 h 1 v 3 h 2 V 2 H 63 V 0 Z"/><path d="m 67,4 v 1 h -1 v 2 h 1 c 0,0 0,3 0,3 h -1 v 1 c 0,0 -4,0 -4,0 v -1 h 2 V 9 h 1 V 8 H 64 V 5 h 1 V 4 Z"/></g><g><path d="m 26,22 h 3 v -1 h -3 z"/><path d="m 31,20 v 1 h 1 v 1 h 1 v -2 z m 1,2 h -1 v -1 h -1 v 2 h 2 z"/><path d="m 34,20 v 3 h 1 v -2 h 1 v 2 h 1 v -2 h -1 v -1 z"/><path d="m 38,19 v 4 h 1 v -4 z"/><path d="m 40,19 v 1 h 1 v -1 z"/><path d="m 40,21 v 2 h 1 v -2 z"/><path d="m 42,23 v -3 h 2 v 1 h 1 c 0,0 0,2 0,2 h -1 v -2 h -1 v 2 z"/><path d="m 46,21 v 2 h 1 v 1 h 1 v -1 h -1 v -2 h 1 v 1 h 1 v -2 h -2 v 1 z"/><path d="m 50,21 c 0,0 0,1 0,1 h 3 v -1 z"/></g><g><path d="m 5,26 v 1 H 4 v 6 H 3 v 7 H 2 v 4 H 1 v 2 H 0 v 3 h 6 v -1 h 2 v -1 h 2 v -1 h 2 v -1 h 2 v -4 h -1 v -1 h -1 v -2 h 1 v -2 h 1 v -1 h 1 v -1 h 1 V 28 H 12 V 27 H 9 v -1 z m 2,4 h 2 v 1 h 3 v 2 h -1 v 1 h -1 v 1 H 9 v 1 H 8 v 1 H 6 V 36 H 7 Z M 6,41 h 2 v 1 h 2 v 1 H 8 v 1 H 6 v 1 H 5 v -2 h 1 z"/><path d="m 17,26 v 3 h 1 v 2 h -1 v 5 h -1 v 4 h -1 v 4 h 1 v 2 h 9 v -1 h 1 v -3 h 1 V 25 h -4 v 5 h 1 v 9 h -1 v 3 h -1 v 1 h -3 v -4 h 1 v -5 h 1 v -8 z"/><path d="m 28,27 v 5 h 1 v 2 h -1 v 14 h 3 V 38 h 1 v 4 h 1 v 4 h 1 v 2 h 3 v -5 h -1 v -4 h -1 v -5 h 3 v -6 h -2 v -1 z m 4,3 h 1 v 1 h -1 z"/><path d="m 40,27 v 21 h 3 V 37 h 1 v 1 h 1 v 1 h 1 v 1 h 1 v 2 h 1 v 1 h 1 v 2 h 4 v -3 h -1 v -1 h -1 v -2 h -1 v -1 h -1 v -1 h -1 v -9 h -2 v -1 z m 3,4 h 2 v 1 h -1 v 1 h -1 z"/><path d="m 52,27 v 1 h -1 v 1 h -1 v 7 h 1 v 1 h 1 v 1 h 1 v 1 h 5 v -1 h 2 v -1 h 1 v -8 h -1 v -1 h -4 v -1 z m 2,4 h 3 v 1 h 1 v 2 h -1 v 1 h -2 v -1 h -1 v -1 h -1 v -1 h 1 z"/><path d="m 63,25 v 4 h 1 v 16 h 4 v -1 h 1 v -1 h 1 v -2 h 2 v 1 h 2 v 1 h 1 v 1 h 4 v -5 h -1 v -3 h -1 v -2 h -1 v -2 h -1 v -2 h -1 v -2 h -1 v -3 h -1 v -1 h -3 v 4 h 1 v 3 h 1 v 2 h 1 v 2 h 1 v 2 h 1 v 1 h -1 v -1 h -4 v 1 H 67 V 26 h -1 v -1 z"/></g></g></svg> </a><div class=blurb>There is no end though there is a start in the past — Infinity.<br> It speaks, it ruins, and it goes though it consumes the soul — Finite.<br> Only the person who has wisdom can read the most foolish one from the history.<br> The daemon that lives in the machine doesn't understand the daemon that lives in the brain.<br> It is funnier that man exceeds the speed of light than machine start writing on a net.<br> It can be said that this is final ultimatum from the people who can think.</div></footer></div>