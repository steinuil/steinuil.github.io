<!doctype html><html lang=en><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,viewport-fit=cover" name=viewport><title>Enumerate your logs</title><meta content="steen's online burrow" name=description><meta content=Zola name=generator><meta content=strict-origin name=referrer><link href=https://sgt.hootr.club/assets/style.css rel=stylesheet><link title="RSS feed" href=/rss.xml rel=alternate type=application/rss+xml><link title="Atom feed" href=/atom.xml rel=alternate type=application/atom+xml><link href=/assets/icon/favicon-152.png rel=apple-touch-icon-precomposed><body class=main-parent><div class=main-parent><header class=main><h1 class=header-title><a href=https://sgt.hootr.club>STEENSBURROW</a></h1><nav><ul class=unstyled><li><a class=unstyled href=https://sgt.hootr.club/me/>me</a><li><a class=unstyled href=https://sgt.hootr.club/blog/>posts</a><li><a class=unstyled href=/rss.xml>rss</a><li><a class=unstyled href=https://sgt.hootr.club/meta/>meta</a></ul></nav></header><main class=main><article><header><h1 class=title>Enumerate your logs</h1><p class=subtitle>Published by <a href=/><i>steen</i></a> on <time datetime=2026-02-01>2026-02-01</time> tagged <a class=tag href=https://sgt.hootr.club/tags/gleam/>#gleam</a> <a class=tag href=https://sgt.hootr.club/tags/patterns/>#patterns</a></header><div class=content><p>I'm working on my Soulseek client <a rel="nofollow noreferrer external" class=external-link href=https://kirarin.hootr.club/git/steinuil/snus>snus</a> (named in honour of <a rel="nofollow noreferrer external" class=external-link href=https://nicotine-plus.org/>nicotine+</a>), which is a Gleam application targeting the BEAM and an attempt to learn some things about OTP. I've also been working on some new projects at work that use structured logging and "audit logging" using structured fields, and I like the pattern! I'd like snus to have structured logs as well. How do I do it?<h2 id=a-crash-introduction-to-gleam>A crash introduction to Gleam</h2><p><a rel="nofollow noreferrer external" class=external-link href=https://gleam.run/>Gleam</a> is a very nice programming language with a mauve pink smiling star as a mascot. I like it a lot! I think Gleam is best described as a functional-first ML-like (as in OCaml and SML) language with a Rust-like syntax. In as few words as I can muster:<ul><li>It's expression-based and has first-class functions, generics, <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#data-types-custom-types>variants</a>, <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#advanced-features-opaque-types>opaque types</a>, pattern matching, tuples, and tail call optimization.<li>It's "strongly" typed, by which I mean that every expression has a type and the only "escape hatch" is foreign function calls AKA <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#advanced-features-externals>externals</a>.<li>In terms of syntactic conveniences it has a <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#functions-pipelines>pipe operator</a>, <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#functions-labelled-arguments>labelled arguments</a>, <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#data-types-record-accessors>flow-based record accessors</a> (which sacrifice global type inference for some great syntactical convenience), a very nifty <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#advanced-features-use><code>use</code> keyword</a> that can act as a <code>do</code> operator and much more, and <a rel="nofollow noreferrer external" class=external-link href=https://tour.gleam.run/everything/#data-types-bit-arrays>binary pattern matching</a> borrowed from Erlang.<li>It compiles to both Erlang and JavaScript (and has a nice <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/lustre/index.html>Elm-like framework for single page apps</a>).<li>It uses a <code>Result(t, err)</code> type to handle errors and it prefers <code>Error(Nil)</code> to <code>option.None</code> in cases where the failure mode is obvious, which encourages a separation of operational failure from a semantical lack of a value.<li>It uses <code>+</code> for integer addition and <code>+.</code> for float addition like OCaml does, which makes me happy.</ul><h2 id=structured-logging>Structured logging</h2><p>Go has a <a rel="nofollow noreferrer external" class=external-link href=https://pkg.go.dev/log/slog>structured logging library</a> whose functions take an unstructured message, and then pairs of <code>(string, any)</code> as varargs. I don't remember which library my workplace uses for structured logging in Python, but I'm sure it has a similar structured.<p>Gleam does not have a dictionary/hash(map)/object literal: it handles dicts just like <a rel="nofollow noreferrer external" class=external-link href=https://package.elm-lang.org/packages/elm/core/latest/Dict>Elm</a>. You can make a dict from a <code>List</code> of <code>#(key, value)</code> if you want, so if you wanted to reproduce <code>slog</code> in Gleam you'd have a <code>print(level: LogLevel, data: List(#(String, String)))</code> function. There's a <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/glogg/index.html>few</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/flash/index.html>structured</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/glight/index.html>logging</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/gclog/index.html>libraries</a> on the <a rel="nofollow noreferrer external" class=external-link href=https://packages.gleam.run/>Gleam package index</a> that fit the bill, but I didn't like any of them and I was wondering how I could reconsider that approach.<p>Gleam doesn't have a built-in syntax for booleans; <code>Bool</code> is a "custom type" like any other that could just as easily be defined in a library:<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=gleam><span class=giallo-l><span style=color:#81a1c1>type</span><span> Bool {</span></span>
<span class=giallo-l><span>  True</span></span>
<span class=giallo-l><span>  False</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>Booleans could just as well be reprenented as the strings <code>"true"</code> and <code>"false"</code>, but languages like Gleam and OCaml and Rust and C# and Java and Go choose to represent booleans as their own type. How many states could a <code>String</code> have compared to a <code>Bool</code>? Would you say, <a href="https://www.youtube.com/watch?v=EWKB86iSlFo" rel="nofollow noreferrer external" class=external-link>ten million</a>?<p>Now think about your application's logs. How many states that are meaningful enough to be logged does your service have? Can you enumerate all of them? Can you gracefully handle the failures? Does the user need to know about it? Is it useful for debugging? Will the log message have to be localized at some point?<p>There's <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/glight>several</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/glogg>structured</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/flash>logging</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/birch>libraries</a> <a rel="nofollow noreferrer external" class=external-link href=https://hexdocs.pm/viva_telemetry/index.html>available</a> in the Gleam package registry. Gleam is a new language whose library ecosystem is still growing, none of these libraries seem to be leading the pack, so I'm not sure I should be committing to any of them. Instead I added a <code>logging</code> module containing a <code>Log</code> variant that contains all the types of things I want to be logging in the application, along with some data that I think will be useful to debug any problems. This will let me easily switch logging implementation in the future, but I think it's also a good pattern to keep in my toolbox.<pre class=giallo style=color:#d8dee9;background-color:#2e3440><code data-lang=gleam><span class=giallo-l><span style=color:#81a1c1>pub type</span><span> Log {</span></span>
<span class=giallo-l><span>  PeerAlreadyConnected(</span></span>
<span class=giallo-l><span>    conn_type: ConnectionType,</span></span>
<span class=giallo-l><span>    ip: IP,</span></span>
<span class=giallo-l><span>    port: Int,</span></span>
<span class=giallo-l><span>  )</span></span>
<span class=giallo-l><span>  PeerViolatedConnectionOrder(</span></span>
<span class=giallo-l><span>    username: String,</span></span>
<span class=giallo-l><span>    message: String,</span></span>
<span class=giallo-l><span>  )</span></span>
<span class=giallo-l><span style=color:#616e88>  // ...</span></span>
<span class=giallo-l><span>}</span></span></code></pre><p>Enumerating special cases in a program is a way to give them semantical meaning. I think logs can be as deserving of care and thought as much as the important part of our applications: maybe just the act of adding the failure case can give you a chance to think about it more carefully. Consider enumerating your logs.</div></article></main><footer class=main><a class=logo href=/> <svg viewbox="0 0 79 49" version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg><title>Steen's online burrow</title><g fill=currentColor><g><path d="M 17,7 V 9 H 15 V 8 h -1 v 3 h 1 v 1 h 2 v 1 h 4 V 9 H 20 V 8 H 19 V 5 h 1 V 4 h 1 V 3 h 4 v 1 h -3 v 3 h 1 v 1 h 1 v 4 h -1 v 1 h -1 c 0,0 0,1 0,1 H 16 V 13 H 13 V 12 10 H 12 V 8 h 1 V 7 Z"/><path d="m 30,5 v 1 h 2 V 5 h 3 v 1 h -2 v 1 h -2 v 4 h -1 v 1 h -1 v 1 h -1 c 0,0 0,2 0,2 h -1 c 0,0 0,1 0,1 h -1 v -3 h 1 v -2 h 1 V 7 H 26 V 6 H 24 V 5 Z"/><path d="m 39,5 v 2 h -1 c 0,0 0,1 0,1 h -1 c 0,0 0,1 0,1 h -2 v 1 h 4 c 0,0 0,2 0,2 h -2 v -1 h -3 v 1 h -1 v 2 h 2 v -1 h 3 v 1 h 1 v 1 h 1 c 0,0 0,1 0,1 h -2 v -1 h -4 c 0,0 0,1 0,1 h -4 v -1 h 1 v -2 h 1 v -2 h 1 V 8 h 3 V 7 h 1 V 6 h 1 V 5 Z"/><path d="m 42,5 v 1 h 1 v 1 h 1 v 1 h 1 v 1 h 2 v 1 H 44 V 9 h -1 v 2 h 3 v 1 h -2 v 1 h -1 v 1 h 2 v -1 h 2 v 2 h -4 c 0,0 0,1 0,1 h -2 v -2 h 1 V 9 H 41 V 7 H 40 V 5 Z"/><path d="m 48,6 v 2 h 1 v 4 h 1 c 0,0 0,2 0,2 h -1 v 3 c 0,0 1,0 1,0 v -1 h 1 v -2 h 1 v -2 h 1 v 1 h 1 v 1 h 1 v 1 h 2 V 14 H 56 V 9 h 1 V 7 h 1 V 5 h 1 V 4 h 1 V 2 h -1 v 1 h -2 v 1 h -1 v 4 h -1 v 4 H 54 V 11 H 53 V 10 H 51 V 8 H 50 V 7 H 49 V 6 Z"/><path d="m 61,0 v 1 h 1 v 3 h 2 V 2 H 63 V 0 Z"/><path d="m 67,4 v 1 h -1 v 2 h 1 c 0,0 0,3 0,3 h -1 v 1 c 0,0 -4,0 -4,0 v -1 h 2 V 9 h 1 V 8 H 64 V 5 h 1 V 4 Z"/></g><g><path d="m 26,22 h 3 v -1 h -3 z"/><path d="m 31,20 v 1 h 1 v 1 h 1 v -2 z m 1,2 h -1 v -1 h -1 v 2 h 2 z"/><path d="m 34,20 v 3 h 1 v -2 h 1 v 2 h 1 v -2 h -1 v -1 z"/><path d="m 38,19 v 4 h 1 v -4 z"/><path d="m 40,19 v 1 h 1 v -1 z"/><path d="m 40,21 v 2 h 1 v -2 z"/><path d="m 42,23 v -3 h 2 v 1 h 1 c 0,0 0,2 0,2 h -1 v -2 h -1 v 2 z"/><path d="m 46,21 v 2 h 1 v 1 h 1 v -1 h -1 v -2 h 1 v 1 h 1 v -2 h -2 v 1 z"/><path d="m 50,21 c 0,0 0,1 0,1 h 3 v -1 z"/></g><g><path d="m 5,26 v 1 H 4 v 6 H 3 v 7 H 2 v 4 H 1 v 2 H 0 v 3 h 6 v -1 h 2 v -1 h 2 v -1 h 2 v -1 h 2 v -4 h -1 v -1 h -1 v -2 h 1 v -2 h 1 v -1 h 1 v -1 h 1 V 28 H 12 V 27 H 9 v -1 z m 2,4 h 2 v 1 h 3 v 2 h -1 v 1 h -1 v 1 H 9 v 1 H 8 v 1 H 6 V 36 H 7 Z M 6,41 h 2 v 1 h 2 v 1 H 8 v 1 H 6 v 1 H 5 v -2 h 1 z"/><path d="m 17,26 v 3 h 1 v 2 h -1 v 5 h -1 v 4 h -1 v 4 h 1 v 2 h 9 v -1 h 1 v -3 h 1 V 25 h -4 v 5 h 1 v 9 h -1 v 3 h -1 v 1 h -3 v -4 h 1 v -5 h 1 v -8 z"/><path d="m 28,27 v 5 h 1 v 2 h -1 v 14 h 3 V 38 h 1 v 4 h 1 v 4 h 1 v 2 h 3 v -5 h -1 v -4 h -1 v -5 h 3 v -6 h -2 v -1 z m 4,3 h 1 v 1 h -1 z"/><path d="m 40,27 v 21 h 3 V 37 h 1 v 1 h 1 v 1 h 1 v 1 h 1 v 2 h 1 v 1 h 1 v 2 h 4 v -3 h -1 v -1 h -1 v -2 h -1 v -1 h -1 v -1 h -1 v -9 h -2 v -1 z m 3,4 h 2 v 1 h -1 v 1 h -1 z"/><path d="m 52,27 v 1 h -1 v 1 h -1 v 7 h 1 v 1 h 1 v 1 h 1 v 1 h 5 v -1 h 2 v -1 h 1 v -8 h -1 v -1 h -4 v -1 z m 2,4 h 3 v 1 h 1 v 2 h -1 v 1 h -2 v -1 h -1 v -1 h -1 v -1 h 1 z"/><path d="m 63,25 v 4 h 1 v 16 h 4 v -1 h 1 v -1 h 1 v -2 h 2 v 1 h 2 v 1 h 1 v 1 h 4 v -5 h -1 v -3 h -1 v -2 h -1 v -2 h -1 v -2 h -1 v -2 h -1 v -3 h -1 v -1 h -3 v 4 h 1 v 3 h 1 v 2 h 1 v 2 h 1 v 2 h 1 v 1 h -1 v -1 h -4 v 1 H 67 V 26 h -1 v -1 z"/></g></g></svg> </a><div class=blurb>There is no end though there is a start in the past — Infinity.<br> It speaks, it ruins, and it goes though it consumes the soul — Finite.<br> Only the person who has wisdom can read the most foolish one from the history.<br> The daemon that lives in the machine doesn't understand the daemon that lives in the brain.<br> It is funnier that man exceeds the speed of light than machine start writing on a net.<br> It can be said that this is final ultimatum from the people who can think.</div></footer></div>